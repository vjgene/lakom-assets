!function(o){"use strict";void 0===o.fn.cartBox&&(o.fn.cartBox={});var t=function(i){this.$modalRootElement=null,this.options=o.extend({},t.DEFAULTS,i),this.init(),this.show()};t.prototype.dispose=function(){this.$modalElement.modal("hide"),this.$modalRootElement.remove(),this.$modalElement=null,this.$modalRootElement=null},t.prototype.init=function(){if(void 0===this.options.alias)throw new Error('CartBox modal option "alias" is not set.');this.$modalRootElement=o("<div/>",{id:"cart-box-modal",class:"modal",role:"dialog",tabindex:-1,ariaLabelled:"#cart-box-modal",ariaHidden:!0}),this.$modalRootElement.one("hide.bs.modal",o.proxy(this.onModalHidden,this)),this.$modalRootElement.one("shown.bs.modal",o.proxy(this.onModalShown,this))},t.prototype.show=function(){this.$modalRootElement.html('<div class="modal-dialog"><div class="modal-content"><div class="modal-body"><span class="spinner"><i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i></span></div></div></div>'),this.$modalRootElement.modal()},t.prototype.hide=function(){this.$modalElement&&this.$modalElement.trigger("hide.bs.modal")},t.prototype.getCartBoxElement=function(){return this.$modalElement.find('[data-control="cart-options"]')},t.prototype.onQuantityOrOptionChanged=function(t){var i=this.$modalElement.find('[name="quantity"]'),n=this.$modalElement.find('[data-control="cart-item"]'),a=parseFloat(n.data("priceAmount"));this.$modalElement.find("input[data-option-price]:checked").each((function(t,i){var n=o(i).data("optionPrice");a+=parseFloat(void 0===n?0:n)})),this.$modalElement.find("select[data-option-price] option:selected").each((function(t,i){var n=o(i).data("optionPrice");a+=parseFloat(void 0===n?0:n)})),this.$modalElement.find('input[data-option-price][type="number"]').each((function(t,i){var n=parseInt(o(i).val()),e=o(i).data("optionPrice");n>0&&(a+=n*parseFloat(void 0===e?0:e))})),a*=i.val();var e=n.data("priceFormat").indexOf(".")>-1?".":",",d=n.data("priceFormat").split(e).pop();n.find("[data-item-subtotal]").html(n.data("priceFormat").replace("0"+e+d,a.toFixed(d.length)))},t.prototype.submitForm=function(){void 0!==this.options.onSubmit&&this.options.onSubmit.call(this)},t.prototype.onModalHidden=function(o){var t=this.$modalElement.find('[data-control="cart-item"]');t.cartItem("dispose"),t.remove(),this.dispose(),void 0!==this.options.onClose&&this.options.onClose.call(this)},t.prototype.onSuccessForm=function(){void 0!==this.options.onSuccess&&this.options.onSuccess.call(this)},t.prototype.onFailedForm=function(){void 0!==this.options.onFail&&this.options.onFail.call(this)},t.prototype.onModalShown=function(t){var i=this;this.$modalElement=o(t.target),o.request(this.options.loadItemHandler,{data:{rowId:this.options.rowId,menuId:this.options.menuId},success:function(t){i.$modalRootElement.html(t.result),i.$modalRootElement.modal();var n=i.$modalElement.find('[data-control="cart-item"]');n.on("input",'[name="quantity"]',o.proxy(i.onQuantityOrOptionChanged,i)),n.on("change","[data-option-price]",o.proxy(i.onQuantityOrOptionChanged,i)),n.on("submit","form",o.proxy(i.submitForm,i)),n.on("ajaxDone","form",o.proxy(i.onSuccessForm,i)),n.on("ajaxFail","form",o.proxy(i.onFailedForm,i)),i.onQuantityOrOptionChanged(),n.cartItem()}})},t.DEFAULTS={alias:void 0,menuItem:void 0,onSubmit:void 0,onClose:void 0},o.fn.cartBox.modal=t}(window.jQuery);